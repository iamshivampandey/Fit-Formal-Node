SELECT 
  oi.orderItemId,
  oi.orderId,
  oi.itemType,
  oi.productCode,
  oi.description,
  oi.shopId,
  oi.tailorId,
  oi.quantity,
  oi.unit,
  oi.unitPrice,
  oi.itemTotal,
  oi.status,
  oi.notes,
  oi.measurementDate,
  oi.measurementSlot,
  oi.stitchingDate,
  oi.isMeasurementDone,
  oi.createdAt,
  oi.updatedAt,
  (
      SELECT
          m.measurementId,
          m.measurementKey,
          m.measurementValue,
          m.notes
      FROM Measurements m
      WHERE m.orderItemId = oi.orderItemId
      FOR JSON PATH
  ) AS measurements
FROM OrderItems oi
WHERE oi.orderId = {{orderId}} 
ORDER BY oi.createdAt ASC;

