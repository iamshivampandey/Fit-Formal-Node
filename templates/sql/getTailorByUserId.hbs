SELECT 
  u.id as userId,
  u.firstName,
  u.lastName,
  u.email as userEmail,
  u.phoneNumber,
  u.isActive,
  bi.businessId,
  bi.businessName,
  bi.ownerName,
  bi.businessLogo,
  bi.businessDescription,
  bi.mobileNumber as businessMobile,
  bi.alternateNumber,
  bi.email as businessEmail,
  bi.shopAddress,
  bi.googleMapLink,
  bi.gpsLatitude,
  bi.gpsLongitude,
  bi.workingCity,
  bi.serviceTypes,
  bi.specialization,
  bi.yearsOfExperience,
  bi.portfolioPhotos,
  bi.certifications,
  bi.openingTime,
  bi.closingTime,
  bi.weeklyOff,
  --ti.name,
  r.role_name as roleName,
  (
      SELECT
          tip.TailorItemPriceId,
          tip.ItemId,
		  ti.Name,
          tip.FullPrice,
          tip.DiscountPrice,
          tip.DiscountType,
          tip.DiscountValue,
          tip.EstimatedDays,
          tip.IsAvailable,
          tip.Notes
      FROM TailorItemPrices tip
	  Inner Join TailorItems ti on tip.ItemId = ti.ItemId
      WHERE tip.BusinessId = bi.businessId
      FOR JSON PATH
  ) AS tailorItemPrices
FROM Users u
INNER JOIN BusinessInformations bi ON bi.userId = u.id
INNER JOIN UserRoles ur ON ur.user_id = u.id
INNER JOIN Roles r ON r.id = ur.role_id
WHERE bi.BusinessId = {{BusinessId}} AND u.isActive = 1 AND r.role_name = 'Tailor';

