WITH DateRange AS (
    SELECT CAST(GETDATE() AS DATE) AS dt
    UNION ALL
    SELECT DATEADD(DAY, 1, dt)
    FROM DateRange
    WHERE dt < DATEADD(DAY, 60, GETDATE())
)
SELECT
    tda.TailorDateAvailabilityId,
    tda.BusinessId,
    dr.dt AS Date,
    tda.IsClosed,
    tda.CreatedAt,
    tda.UpdatedAt,
    COUNT(DISTINCT ori.orderId) AS totalOrderCount
FROM DateRange dr
LEFT JOIN TailorDateAvailability tda
    ON tda.Date = dr.dt
    AND tda.BusinessId = {{BusinessId}}
LEFT JOIN OrderItems ori
    ON CAST(ori.stitchingDate AS DATE) = dr.dt
    AND ori.tailorId = {{BusinessId}}
GROUP BY
    tda.TailorDateAvailabilityId,
    tda.BusinessId,
    dr.dt,
    tda.IsClosed,
    tda.CreatedAt,
    tda.UpdatedAt
ORDER BY dr.dt;



